minimum_cumulusci_version: '3.38.0'
project:
    name: NPSP-PostInstallSteps
    package:
        name: NPSP-PostInstallSteps
        api_version: '50.0'
    git:
        default_branch: 'main'
        repo_url: https://github.com/SFDO-Alliances/NPSP-PostInstallSteps
    source_format: sfdx

tasks:
    robot:
        options:
            suites: robot/NPSP-PostInstallSteps/tests
            options:
                outputdir: robot/NPSP-PostInstallSteps/results

    robot_testdoc:
        options:
            path: robot/NPSP-PostInstallSteps/tests
            output: robot/NPSP-PostInstallSteps/doc/NPSP-PostInstallSteps_tests.html

    run_tests:
        options:
            required_org_code_coverage_percent: 75

plans:
  install:
    slug: install
    title: Install NPSP Post Install Template
    tier: primary
    description: NPSP Post Installation steps template
    is_listed: True
    checks:
      - when: "not tasks.check_my_domain_active()"
        action: error
        message: "Please enable My Domain in your org prior to installing."    
      - when: "'npsp' not in tasks.get_installed_packages()"
        action: error
        message: "NPSP Post Installation requires the Nonprofit Success Pack. Please install the Nonprofit Success Pack and try again."
    steps:
        1:
            task: unschedule_apex
            ui_options:
                name: Unschedule Scheduled Apex Jobs
                is_required: False
                is_recommended: True
        2:
            task: deploy
            ui_options:
                name: Contact and Opportunity Picklists
            options:
                path: unpackaged/pre/picklists
        3:
            task: deploy
            ui_options:
                name: Opportunity Record Types, Business Processes
            options:
                path: unpackaged/pre/record_types          
        4:
            task: deploy
            ui_options:
                name: Additional Post Installation Configuration
                is_required: True
                is_recommended: True
            options:
                path: unpackaged/pre/src 
        5:
            task: deploy
            ui_options:
                name: Account and Contact Page Layouts
            options:
                path: unpackaged/pre/layouts
        6:
            task: deploy
            ui_options:
                name: Account and Opportunity List Views
                is_required: False
                is_recommended: True
            options:
                path: unpackaged/pre/listviews   
        7:
            task: update_admin_profile
            ui_options:
                name: Update Profile  
        8:
            task: load_dataset
            ui_options:
                name: Load Reciprocal Relationship Data